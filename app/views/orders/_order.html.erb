<div id="<%= dom_id(order) %>" 
     class="rounded-lg p-5 bg-white shadow-md hover:shadow-lg transition-all duration-300 <%= 'animate-pulse-once border-2 border-green-500' if order.created_at > 5.seconds.ago %>">
  
  <!-- Header -->
  <div class="flex justify-between items-start mb-3">
    <div class="flex-grow">
      <div class="flex items-center gap-2">
        <h3 class="font-bold text-xl text-gray-900">Table <%= order.table.label %></h3>
        <% if order.created_at > 30.seconds.ago %>
          <span class="px-2 py-0.5 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse">NEW</span>
        <% end %>
      </div>
      <div class="flex items-center gap-2 mt-1">
        <p class="text-sm text-gray-600">Order #<%= order.id %></p>
        <span class="text-xs text-gray-400">•</span>
        <p class="text-xs text-gray-500"><%= time_ago_in_words(order.created_at) %> ago</p>
      </div>
    </div>
    
    <div class="text-right flex-shrink-0 ml-4">
      <p class="font-bold text-xl text-gray-900"><%= number_to_currency(order.total_cents / 100.0, unit: "€") %></p>
      
      <!-- Status Badge -->
      <span class="inline-block mt-1 px-3 py-1 text-xs font-semibold rounded-full
        <%= case order.status
            when 'paid' then 'bg-green-100 text-green-800'
            when 'ready' then 'bg-blue-100 text-blue-800'
            when 'preparing' then 'bg-yellow-100 text-yellow-800'
            when 'served' then 'bg-gray-100 text-gray-800'
            else 'bg-orange-100 text-orange-800'
            end %>">
        <%= order.status.upcase %>
      </span>
    </div>
  </div>

  <!-- Payment Status (if partially paid) -->
  <% if order.paid_cents > 0 && order.paid_cents < order.total_cents %>
    <div class="mb-3 p-2 bg-blue-50 rounded-lg border border-blue-200">
      <div class="flex justify-between items-center text-sm">
        <span class="text-blue-800 font-medium">Partial Payment</span>
        <span class="text-blue-900 font-bold">
          <%= number_to_currency(order.paid_cents / 100.0, unit: "€") %> / <%= number_to_currency(order.total_cents / 100.0, unit: "€") %>
        </span>
      </div>
      <div class="mt-1 bg-blue-200 rounded-full h-2">
        <% payment_percentage = (order.paid_cents.to_f / order.total_cents * 100).round %>
        <div class="bg-blue-600 h-2 rounded-full transition-all duration-500" 
             style="width: <%= payment_percentage %>%;"></div>
      </div>
    </div>
  <% end %>

  <!-- Order Items -->
  <div class="border-t border-gray-200 pt-3 mt-3">
    <h4 class="text-sm font-semibold text-gray-700 mb-2">Items:</h4>
    <div class="space-y-1">
      <% order.order_items.each do |item| %>
        <div class="flex justify-between items-center py-1.5 px-2 bg-gray-50 rounded">
          <div class="flex items-center gap-2">
            <span class="inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-gray-700 rounded-full">
              <%= item.qty %>
            </span>
            <span class="font-medium text-gray-900"><%= item.name_snapshot %></span>
          </div>
          <span class="text-sm text-gray-600"><%= number_to_currency(item.line_total / 100.0, unit: "€") %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Action Buttons -->
  <% if order.status != 'served' %>
    <div class="mt-4 pt-3 border-t border-gray-200 flex gap-2">
      <% if order.status != 'ready' %>
        <%= button_to "Mark Ready", order_status_path(order), method: :patch, params: { status: 'ready' }, 
            form: { data: { turbo_stream: true } },
            class: "flex-1 px-4 py-2.5 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 active:bg-blue-800 transition-colors shadow-sm" %>
      <% end %>
      <%= button_to "Complete", order_status_path(order), method: :patch, params: { status: 'served' }, 
          form: { data: { turbo_stream: true } },
          class: "flex-1 px-4 py-2.5 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 active:bg-green-800 transition-colors shadow-sm" %>
    </div>
  <% end %>
</div>
